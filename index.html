<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Hopfield NN: Training Data</title>
	<link rel="stylesheet" type="text/css" href="./node_modules/bulma/css/bulma.css">
	<link rel="stylesheet" type="text/css" href="./css/app.css">
	<link href="https://use.fontawesome.com/releases/v5.0.2/css/all.css" rel="stylesheet">
</head>
<body>
	<section class="section">
		<div class="columns">
			<div class="column is-3">
				<nav class="panel">
				  <p class="panel-heading">
				    Pattern Recognition
				  </p>
				  <p class="panel-tabs">
				    <a class="is-active">Train</a>
				    <a>Test</a>
				    <a>Summary</a>
				    <a>About</a>
				    <a>Github</a>
				  </p>
				  <div id="menu">
				  	  <div class="panel-block">
					  	<div class="control">
					  		<label>Binary Treshold</label>
					  		<input type="number" class="input" name="tresholdPreprocessing" value="200">
					  	</div>
					  	<div>
					  	</div>
					  </div>
					  <div class="panel-block">
				    	<div class="field">
				    		<div class="file has-name is-small is-primary is-boxed">
							  <label class="file-label">
							    <input class="file-input" type="file" accept="image/*" name="image">
							    <span class="file-cta is-warning">
							      <span class="file-icon">
							        <i class="fa fa-file-image"></i>
							      </span>
							      <span class="file-label">
							        Load Image
							      </span>
							    </span>
							    <span class="file-name">
							      File Name
							    </span>
							  </label>
							</div>
				    	</div>
					  </div>
					  <div class="panel-block">
					  	<div class="field is-horizontal">
					  		<div class="control has-rig">
						  		<label>param1</label>
						  		<input class="input" type="number">
						  	</div>
						  	<div class="control has-rig">
						  		<label>param2</label>
						  		<input class="input" type="number">
						  	</div>
						  	<div class="control has-rig">
						  		<label>param3</label>
						  		<input class="input" type="number">
						  	</div>
					  	</div>
					  </div>
					  <div class="panel-block">
					  	<div class="control">
					  		<label>Recognize As</label>
					  		<input type="text" class="input" name="nama_sayur" placeholder="ex: wortel">
					  	</div>
					  	<div>
					  	</div>
					  </div>
					  <div class="panel-block">
					  	<button class="button is-primary is-outlined" id="train_button">
					  		Train Data
					  	</button>
					  	<button class="button is-primary is-outlined" id="draw">
					  		draw
					  	</button>
					  </div>
				  </div>
				</nav>
			</div>
			<div class="column is-9">
				<div class="my-box">
					<h1 class="title is-size-5">Preprocessing Image</h1>
					<div class="has-text-centered my-box" style="margin-bottom: 50px">
						<img id="imgCitraAsli" src="./static/icon/fileImage.png" class="canvas" width="200px" height="200px">
						<br>
						<h1>Citra Asli</h1>
					</div>
					<div class="columns">
						<div class="column has-text-centered">
							<canvas class="canvas" id="citraScale" width="100" height="100"></canvas>
							<h1>Citra Scale (100 x 100)</h1>	
						</div>
						<div class="column has-text-centered">
							<canvas class="canvas" id="citraAbu" width="100" height="100"></canvas>
							<h1>Citra Abu (100 x 100)</h1>	
						</div>
						<div class="column has-text-centered">
							<canvas class="canvas" id="citraBiner" width="100" height="100"></canvas>
							<h1 >Citra Biner (100 x 100)</h1>	
						</div>
						<div class="column has-text-centered">
							<div id="binary" class="is-very-small"></div>
							<h1 style="margin-top: 8px">Array biner</h1>	
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<script type="text/javascript" src="./js/jquery.min.js"></script>
	<script type="text/javascript" src="./js/file.js"></script>
	<script type="text/javascript" src="./js/canvas.js"></script>
	<script type="text/javascript" src="./js/processing.js"></script>
	<script type="text/javascript" src="./js/hopfield.js"></script>
</body>
</html>
<script>
	/*Canvas variable*/
	const citraScale 	= new Canvas(document.getElementById("citraScale"));
	const citraAbu  	= new Canvas(document.getElementById("citraAbu"));
	const citraBiner  = new Canvas(document.getElementById("citraBiner"));
	var citra = new Image();
	var extractedDataForTrain = [];
	var network = new HopfieldNetwork(10000);
	network.initialiseNodes()

	/*do preprocessing*/
	function preProcess(citra, treshold) {
		citraScale.drawFromImage(citra, true);
		citraAbu.drawImageByData(grayScale(citraScale.getImageData()));
		citraBiner.drawImageByData(biner(citraAbu.getImageData(), treshold));
		extractedDataForTrain = getBinaryData(citraBiner.getImageData());
		var binaryForPrint = extractedDataForTrain.slice(0);
		$("#binary").empty().append(binaryArrayPrettyPrint(binaryForPrint));
	}

	/*onchange image event*/
	$("input[name=image]").on("change", function () {
		var treshold = $("input[name=tresholdPreprocessing]").val();
		$(".file-name").empty().append(this.files[0].name);
		readURL(this, function (res) {
			citra.onload = function () {
				preProcess(citra, treshold);
			}
			$("#imgCitraAsli").attr("src", res.target.result);
			citra.src = res.target.result;
		});
	});

	/*onchange treshold event*/
	$("input[name=tresholdPreprocessing]").on("change", function () {
		preProcess(citra, this.value);
	});

	$("#train_button").on("click", function () {
		$("#binary").empty()
		network.setActivations(extractedDataForTrain)
		network.addActivationsPattern()
	})

	$("#draw").on("click", function () {
		network.setActivations(extractedDataForTrain)
		$("#binary").empty().append(binaryArrayPrettyPrint(network.recover()))
	})

</script>
